import { useEffect, useState } from 'react';

/**
 * A component that toggles the dark mode of the application.
 * It uses the local storage to persist the dark mode state.
 *
 * @return {JSX.Element} The dark mode toggle button.
 */
const DarkToggler = () => {
  /**
   * The state of the dark mode.
   *
   * @type {boolean}
   */
  const [darkModeState, setDarkModeState] = useState(false);

  useEffect(() => {
    /**
     * Sets the initial dark mode state based on the local storage and the user's preference.
     */
    if (
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
      setDarkModeState(true);
    } else {
      document.documentElement.classList.remove('dark');
      setDarkModeState(false);
    }
  }, []);

  /**
   * Toggles the dark mode state and updates the local storage.
   */
  const toggleDarkMode = () => {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark');
      localStorage.theme = 'light';
      setDarkModeState(false);
    } else {
      document.documentElement.classList.add('dark');
      localStorage.theme = 'dark';
      setDarkModeState(true);
    }
  };

  return (
    <>
      <button
        onClick={toggleDarkMode}
        data-tooltip-target="tooltip-dark"
        className="p-2 rounded bg-indigo-600 text-white dark:bg-indigo-600"
      >
        {darkModeState ? (
          <svg
            className="w-6 h-6 text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
              d="M12 5V3m0 18v-2M7.05 7.05 5.636 5.636m12.728 12.728L16.95 16.95M5 12H3m18 0h-2M7.05 16.95l-1.414 1.414M18.364 5.636 16.95 7.05M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"
            />
          </svg>
        ) : (
          <svg
            className="w-6 h-6 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fillRule="evenodd"
              d="M11.675 2.015a.998.998 0 0 0-.403.011C6.09 2.4 2 6.722 2 12c0 5.523 4.477 10 10 10 4.356 0 8.058-2.784 9.43-6.667a1 1 0 0 0-1.02-1.33c-.08.006-.105.005-.127.005h-.001l-.028-.002A5.227 5.227 0 0 0 20 14a8 8 0 0 1-8-8c0-.952.121-1.752.404-2.558a.996.996 0 0 0 .096-.428V3a1 1 0 0 0-.825-.985Z"
              clipRule="evenodd"
            />
          </svg>
        )}
      </button>
      <div
        id="tooltip-dark"
        role="tooltip"
        className="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700"
      >
        Toggle dark mode
        <div className="tooltip-arrow" data-popper-arrow></div>
      </div>
    </>
  );
};

export default DarkToggler;
